{% extends "base.html" %}
{% block content %}
<div class="page-header">
    <h2><i class="bi bi-pencil-square"></i> Enter Marks</h2>
    <p class="text-muted">Select class, subject, and exam</p>
</div>

<!-- Selection Form -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label">Class</label>
                <select class="form-select" name="class_id" onchange="this.form.submit()">
                    <option value="">Select Class</option>
                    {% for c in classes %}
                    <option value="{{ c.id }}" {% if selected_class==c.id|string %}selected{% endif %}>{{ c.grade }}-{{
                        c.section }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Subject</label>
                <select class="form-select" name="subject_id" onchange="this.form.submit()">
                    <option value="">Select Subject</option>
                    {% for s in subjects %}
                    <option value="{{ s.id }}" {% if selected_subject==s.id|string %}selected{% endif %}>{{ s.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Exam</label>
                <select class="form-select" name="exam_id" onchange="this.form.submit()">
                    <option value="">Select Exam</option>
                    {% for e in exams %}
                    <option value="{{ e.id }}" {% if selected_exam==e.id|string %}selected{% endif %}>{{ e.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100"><i class="bi bi-search"></i> Load</button>
            </div>
        </form>
    </div>
</div>

{% if students and selected_class and selected_subject and selected_exam %}
<div class="card">
    <div class="card-header"><i class="bi bi-people"></i> {{ students|length }} Students</div>
    <div class="card-body p-0">
        <form method="POST">
            <input type="hidden" name="class_id" value="{{ selected_class }}">
            <input type="hidden" name="subject_id" value="{{ selected_subject }}">
            <input type="hidden" name="exam_id" value="{{ selected_exam }}">
            <div class="p-3">
                <label class="form-label">Max Score</label>
                <input type="number" class="form-control w-25" name="max_score" value="100" required>
            </div>
            <table class="table table-dark table-hover mb-0">
                <thead>
                    <tr>
                        <th>Roll</th>
                        <th>Name</th>
                        <th>Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in students %}
                    <tr>
                        <td><code>{{ s.roll_no }}</code></td>
                        <td>{{ s.first_name }} {{ s.last_name }}</td>
                        <td><input type="number" class="form-control form-control-sm" name="score_{{ s.id }}"
                                value="{{ existing_marks.get(s.id, '') }}" min="0" step="0.5" style="width: 100px;">
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="p-3"><button type="submit" class="btn btn-primary"><i class="bi bi-check-lg"></i> Save
                    Marks</button></div>
        </form>
    </div>
</div>
{% elif selected_class and selected_subject and selected_exam %}
<div class="card">
    <div class="card-body text-center py-4">No students in this class</div>
</div>
{% else %}
<div class="card">
    <div class="card-body empty-state"><i class="bi bi-arrow-up-circle"></i>
        <p>Select class, subject, and exam to enter marks</p>
    </div>
</div>
{% endif %}
{% endblock %}